pipeline 
{
	agent any
	triggers{
	    cron('H 0 * * *')
	}
	options
	{
		gitLabConnection('Jenkins')
		gitlabCommitStatus(name: 'Jenkins')
        gitlabBuilds(builds: ['Prebuild', 'Build', 'Deploy'])
	}
	stages 
	{
		stage('Prebuild')
		{
			steps
			{
				gitlabCommitStatus("Prebuild")
				{
				    checkout scm
				}
			}
		}
		stage('Build') 
		{
			steps 
			{
				gitlabCommitStatus("Build")
				{
				    sh 'chmod +x gradlew'
                    sh './gradlew build'

				}
			}
			
		}
		stage('Deploy')
		{
			steps
			{
				gitlabCommitStatus("Deploy")
				{
				    archiveArtifacts artifacts: 'build/libs/DefaultSettings-*.jar', fingerprint: true
                    cleanWs()
				}
			}
		}
	}
	post {
	success {
	  echo 'posting success to GitLab'
          updateGitlabCommitStatus(name: 'Jenkins', state: 'success')
  	}
	failure {
	  echo 'postinng failure to GitLab'
          updateGitlabCommitStatus(name: 'Jenkins', state: 'failed')
  	}
  }

}