pipeline 
{
	agent any
	triggers{
	    cron('H 0 * * *')
	}
	stages 
	{
		stage('Checkout')
		{
			steps
			{
				updateGitlabCommitStatus(name: 'jenkins-build', state: 'Checkout')
				{
				    checkout scm
				}
			}
		}
		stage('Build') 
		{
			steps 
			{
				updateGitlabCommitStatus(name: 'jenkins-build', state: 'Build')
				{
				    sh 'chmod +x gradlew'
                    sh './gradlew build'

				}
			}
			
		}
		stage('Deploy')
		{
			steps
			{
				updateGitlabCommitStatus(name: 'jenkins-build', state: 'Deploy')
				{
				    archiveArtifacts artifacts: 'build/libs/DefaultSettings-*.jar', fingerprint: true
                    cleanWs()
				}
			}
		}
	}
	options
	{
		gitLabConnection('Jenkins')
	}
	post {
	success {
	  echo 'posting success to GitLab'
          updateGitlabCommitStatus(name: 'jenkins-build', state: 'success')
  	}
	failure {
	  echo 'postinng failure to GitLab'
          updateGitlabCommitStatus(name: 'jenkins-build', state: 'failed')
  	}
  }

}